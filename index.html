import React, { useState, useEffect } from 'react';
import { Plane, Music, Copy, Sparkles, MapPin, Radio, Mic2, Disc, Check, Loader2, AlignLeft, FileText, Languages, Guitar, Image, Video, Hash } from 'lucide-react';

const SunoPromptBuilder = () => {
  // --- Global Config ---
  const apiKey = ""; // Îü∞ÌÉÄÏûÑ ÌôòÍ≤ΩÏóêÏÑú API ÌÇ§Í∞Ä ÏûêÎèô Ï†úÍ≥µÎê©ÎãàÎã§.

  // --- State Management ---
  const [activeTab, setActiveTab] = useState("custom"); 
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState("");
  
  // ÏÉùÏÑ±Îêú Í≤∞Í≥ºÎ¨º ÏÉÅÌÉú (ÌôïÏû•Îê®)
  const [generatedResult, setGeneratedResult] = useState({
    title: "",
    prompt: "",
    lyrics: "",
    albumArt: "",       // New: Ïï®Î≤î ÏïÑÌä∏ ÌîÑÎ°¨ÌîÑÌä∏
    story: ""           // New: Ïú†ÌäúÎ∏å ÏòÅÏÉÅ ÏÑ§Î™Ö Î∞è Ïä§ÌÜ†Î¶¨
  });
  
  // Î≥µÏÇ¨ ÏÉÅÌÉú Í¥ÄÎ¶¨
  const [copyStatus, setCopyStatus] = useState({ 
    title: false, 
    prompt: false, 
    lyrics: false,
    albumArt: false,
    story: false 
  });

  // Ïª§Ïä§ÌÖÄ Î™®Îìú ÏûÖÎ†• ÏÉÅÌÉú
  const [selectedLocation, setSelectedLocation] = useState("");
  const [selectedVibe, setSelectedVibe] = useState("");
  const [selectedGenre, setSelectedGenre] = useState("");
  const [selectedTempo, setSelectedTempo] = useState("Mid-Tempo");
  
  // Ïñ∏Ïñ¥ ÏÑ†ÌÉù ÏÉÅÌÉú
  const [lyricsLanguage, setLyricsLanguage] = useState("Korean"); 

  // --- Data: 50+ Global Locations with Context ---
  const locationGroups = {
    "Asia (ÏïÑÏãúÏïÑ)": [
      { name: "ÏÑúÏö∏ ÌïúÍ∞ï Í≥µÏõê (Seoul)", value: "Han River Park at Night, Seoul", context: "K-Indie, Sentimental Ballad, City Lights, Soju vibe" },
      { name: "ÎèÑÏøÑ ÏãúÎ∂ÄÏïº Í±∞Î¶¨ (Tokyo)", value: "Shibuya Crossing, Tokyo", context: "J-Pop, City Pop, Neon lights, Busy, Energetic" },
      { name: "ÍµêÌÜ†Ïùò Í≥†Ï¶àÎÑâÌïú ÏÇ¨Ïõê (Kyoto)", value: "Kyoto Old Temple", context: "Traditional Asian Instruments, Koto, Zen, Peaceful, Nature" },
      { name: "ÌôçÏΩ©Ïùò Î∞§Í±∞Î¶¨ (Hong Kong)", value: "Hong Kong Night Market", context: "Cyberpunk, Synthwave, Neon, Rain, Cantonese vibe" },
      { name: "ÏÉÅÌïòÏù¥ ÏôÄÏù¥ÌÉÑ (Shanghai)", value: "The Bund, Shanghai", context: "Nu-Jazz, Sophisticated, Piano Lounge, Luxury" },
      { name: "Î∞©ÏΩï Ïπ¥Ïò§ÏÇ∞ Î°úÎìú (Bangkok)", value: "Khaosan Road, Bangkok", context: "Tropical House, Upbeat, Party, Street Food, Energetic" },
      { name: "Î∞úÎ¶¨ Ïö∞Î∂ìÏùò Ïà≤ (Bali)", value: "Ubud Rainforest, Bali", context: "Gamelan, Meditation, Ambient, Nature Sounds, Healing" },
      { name: "ÌÉÄÏù¥Î≤†Ïù¥Ïùò ÎπÑ Ïò§Îäî Í±∞Î¶¨ (Taipei)", value: "Rainy Street in Taipei", context: "Mandopop Ballad, Nostalgic, Acoustic Guitar, Rain" },
      { name: "Í≤ΩÏÑ±(ÏÑúÏö∏) 1930s", value: "1930s Kyungsung", context: "Swing Jazz, Accordion, Retro Korean, Modern Boy" },
      { name: "Î™∞ÎîîÎ∏å Ìï¥Î≥Ä (Maldives)", value: "Maldives Resort Beach", context: "Tropical Chill, Ukulele, Ocean Waves, Bright" }
    ],
    "Europe (Ïú†ÎüΩ)": [
      { name: "Îü∞Îçò ÌÉÄÏõåÎ∏åÎ¶øÏßÄ (London)", value: "Tower Bridge, London", context: "Britpop, Alternative Rock, Foggy, Melancholic" },
      { name: "ÌååÎ¶¨ ÏóêÌé†ÌÉë ÏïÑÎûò (Paris)", value: "Under the Eiffel Tower, Paris", context: "French Chanson, Accordion, Romantic, Waltz" },
      { name: "Î≤†Î•ºÎ¶∞ ÌÅ¥ÎüΩ (Berlin)", value: "Underground Club in Berlin", context: "Minimal Techno, Industrial, Dark, Bass-heavy" },
      { name: "Î°úÎßà ÏΩúÎ°úÏÑ∏ÏõÄ (Rome)", value: "Colosseum, Rome", context: "Italian Opera fusion, Epic, Orchestral, History" },
      { name: "Î≤†ÎÑ§ÏπòÏïÑ Ïö¥Ìïò (Venice)", value: "Venice Canals", context: "Classical Guitar, Serenade, Romantic, Water sounds" },
      { name: "ÏÇ∞ÌÜ†Î¶¨Îãà (Santorini)", value: "Santorini Sunset", context: "Mediterranean Folk, Acoustic, Bright, breezy" },
      { name: "ÌîÑÎùºÌïò Ïò¨ÎìúÌÉÄÏö¥ (Prague)", value: "Old Town Square, Prague", context: "Classical Crossover, Violin, Romantic, Bohemain" },
      { name: "Î∞îÎ•¥ÏÖÄÎ°úÎÇò Ìï¥Î≥Ä (Barcelona)", value: "Barceloneta Beach", context: "Latin Pop, Flamenco Guitar, Passionate, Summer" },
      { name: "ÏïÑÏù¥Ïä¨ÎûÄÎìú Ïò§Î°úÎùº (Iceland)", value: "Icelandic Aurora", context: "Post-Rock, Ethereal, Sigur Ros vibe, Space, Reverb" },
      { name: "Ïä§ÏúÑÏä§ ÏïåÌîÑÏä§ (Swiss Alps)", value: "Swiss Alps Mountain", context: "Yodeling fusion, Folk, Orchestral, Majestic, Fresh air" },
      { name: "ÏïîÏä§ÌÖåÎ•¥Îã¥ Ïö¥Ìïò (Amsterdam)", value: "Amsterdam Canals", context: "Lo-fi Hip Hop, Chill, Bicycle bell sounds, Relaxed" },
      { name: "Ïù¥Ïä§ÌÉÑÎ∂à Í∑∏ÎûúÎìú Î∞îÏûêÎ•¥ (Istanbul)", value: "Grand Bazaar, Istanbul", context: "Middle Eastern Instruments, Oud, Mystic, Exotic" }
    ],
    "North America (Î∂ÅÎØ∏)": [
      { name: "Îâ¥Ïöï ÌÉÄÏûÑÏä§ÌÄòÏñ¥ (New York)", value: "Times Square, NYC", context: "East Coast Hip Hop, Jazz Rap, Urban, Busy, Siren sounds" },
      { name: "Î∏åÎ£®ÌÅ¥Î¶∞ Ïû¨Ï¶àÎ∞î (Brooklyn)", value: "Brooklyn Jazz Bar", context: "Cool Jazz, Double Bass, Smoky, Saxophone solo" },
      { name: "LA ÏÇ∞ÌÉÄÎ™®ÎãàÏπ¥ ÎπÑÏπò (Los Angeles)", value: "Santa Monica Beach, LA", context: "West Coast Rock, Surf Rock, Driving, Sunny" },
      { name: "ÎùºÏä§Î≤†Ïù¥Í±∞Ïä§ (Las Vegas)", value: "Las Vegas Strip", context: "Big Band, Show tune, Glitz, Glamour, Upbeat" },
      { name: "ÎßàÏù¥Ïï†ÎØ∏ ÏÇ¨Ïö∞Ïä§ÎπÑÏπò (Miami)", value: "Miami South Beach", context: "Synthwave, 80s Retro, Neon, Party" },
      { name: "ÏãúÏπ¥Í≥† Î∏îÎ£®Ïä§ ÌÅ¥ÎüΩ (Chicago)", value: "Chicago Blues Club", context: "Chicago Blues, Electric Guitar, Soulful, Gritty" },
      { name: "Îâ¥Ïò¨Î¶¨Ïñ∏Ïä§ ÌîÑÎ†åÏπòÏøºÌÑ∞ (New Orleans)", value: "French Quarter, New Orleans", context: "Dixieland Jazz, Brass Band, Funky, Festive" },
      { name: "ÌïòÏôÄÏù¥ ÏôÄÏù¥ÌÇ§ÌÇ§ (Hawaii)", value: "Waikiki Beach, Hawaii", context: "Hawaiian Folk, Slack Key Guitar, Hula, Relaxed" },
      { name: "Î∞¥Ïø†Î≤ÑÏùò Í≤®Ïö∏ (Vancouver)", value: "Winter in Vancouver", context: "Indie Folk, Acoustic, Rainy, Cozy" }
    ],
    "South America (ÎÇ®ÎØ∏)": [
      { name: "Î¶¨Ïö∞ ÏΩîÌååÏπ¥Î∞îÎÇò (Rio)", value: "Copacabana Beach, Rio", context: "Bossa Nova, Samba, Percussion, Soft Vocals, Warm" },
      { name: "Î∂ÄÏóêÎÖ∏Ïä§ÏïÑÏù¥Î†àÏä§ (Buenos Aires)", value: "Streets of Buenos Aires", context: "Tango, Bandoneon, Passionate, Dramatic" },
      { name: "ÏïÑÎ∞îÎÇò ÎßêÎ†àÏΩò (Havana)", value: "Malecon, Havana", context: "Afro-Cuban Jazz, Salsa, Piano, Rhythmic" },
      { name: "Ïπ∏Ïø§ Î¶¨Ï°∞Ìä∏ (Cancun)", value: "Cancun Resort Party", context: "Reggaeton, Tropical, Dance, Summer vibe" }
    ],
    "Others (Í∏∞ÌÉÄ)": [
      { name: "ÏãúÎìúÎãà Ïò§ÌéòÎùº ÌïòÏö∞Ïä§ (Sydney)", value: "Sydney Harbour", context: "Modern Pop, Uplifting, Fresh, Ocean breeze" },
      { name: "Ïπ¥Ïù¥Î°ú ÌîºÎùºÎØ∏Îìú (Cairo)", value: "Pyramids of Giza", context: "Egyptian Folk, Arabic Scales, Mystery, Ancient" },
      { name: "ÎëêÎ∞îÏù¥ ÏÇ¨Îßâ (Dubai)", value: "Dubai Desert Safari", context: "Arabic Trap, Luxury, Beat-heavy, Exotic" },
      { name: "ÏºÄÏù¥ÌîÑÌÉÄÏö¥ (Cape Town)", value: "Cape Town Coast", context: "Afrobeats, Rhythm, Joyful, Sunny" }
    ]
  };

  // --- Data: Genre Groups (New Feature) ---
  const genreGroups = {
    "‚ú® ÏóêÏÑºÏÖú (Essentials - Í∏∞Î≥∏ Ï∂îÏ≤ú)": [
      "Jazz (Ïû¨Ï¶à)",
      "Bossa Nova (Î≥¥ÏÇ¨ÎÖ∏Î∞î)",
      "Sentimental Ballad (Í∞êÏÑ± Î∞úÎùºÎìú)",
      "Indie Pop (Ïù∏Îîî Ìåù)",
      "Lo-fi Hip Hop (Î°úÌååÏù¥ ÌûôÌï©)",
      "Classical (ÌÅ¥ÎûòÏãù)",
      "Acoustic Guitar Solo (Í∏∞ÌÉÄ Ïó∞Ï£ºÍ≥°)",
      "Cello Solo (Ï≤ºÎ°ú Ïó∞Ï£ºÍ≥°)",
      "Piano Solo (ÌîºÏïÑÎÖ∏ Ïó∞Ï£ºÍ≥°)"
    ],
    "üéπ ÏùºÎ†âÌä∏Î°úÎãâ & Ìåù (Electronic & Pop)": [
      "City Pop (ÏãúÌã∞Ìåù)",
      "Synthwave (Ïã†Ïä§Ïõ®Ïù¥Î∏å)",
      "Deep House (Îî• ÌïòÏö∞Ïä§)",
      "Chillout (Ïπ†ÏïÑÏõÉ)",
      "Dream Pop (ÎìúÎ¶ºÌåù)",
      "R&B (ÏïåÏï§ÎπÑ)",
      "Future Bass (Ìì®Ï≤ò Î≤†Ïù¥Ïä§)",
      "Ambient (Ïó†ÎπÑÏñ∏Ìä∏)"
    ],
    "üéª ÏãúÎÑ§ÎßàÌã± & Î∂ÑÏúÑÍ∏∞ (Cinematic)": [
      "Film Score (ÏòÅÌôî ÏùåÏïÖ)",
      "Orchestral (Ïò§ÏºÄÏä§Ìä∏Îùº)",
      "Noir Jazz (Îã§ÌÅ¨/ÎäêÏôÄÎ•¥ Ïû¨Ï¶à)",
      "Ethereal (Î™ΩÌôòÏ†ÅÏù∏)",
      "Epic (ÏõÖÏû•Ìïú)",
      "New Age (Îâ¥ÏóêÏù¥ÏßÄ)"
    ],
    "üé∏ Î∞¥Îìú & Î¶¨Îì¨ (Band & Rhythm)": [
      "Soft Rock (ÏÜåÌîÑÌä∏ ÎùΩ)",
      "Alternative Rock (ÏñºÌÑ∞ÎÑàÌã∞Î∏å ÎùΩ)",
      "Funk (ÌéëÌÅ¨)",
      "Disco (ÎîîÏä§ÏΩî)",
      "Soul (ÏÜåÏö∏)",
      "Blues (Î∏îÎ£®Ïä§)"
    ],
    "üåç ÏõîÎìú ÎÆ§ÏßÅ (World)": [
      "French Chanson (ÏÉπÏÜ°)",
      "Latin Jazz (ÎùºÌã¥ Ïû¨Ï¶à)",
      "Reggae (Î†àÍ≤å)",
      "Celtic (ÏºàÌã±)",
      "Tango (ÌÉ±Í≥†)"
    ]
  };

  const vibes = [
    "Í∞êÏÑ±Ï†ÅÏù¥Í≥† Ïö∞Ïö∏Ìïú (Melancholic)",
    "Ìù¨ÎßùÏ∞®Í≥† Î≤ÖÏ∞¨ (Uplifting)",
    "ÎÇòÎ•∏ÌïòÍ≥† Ìé∏ÏïàÌïú (Chill)",
    "Í∏¥Ïû•Í∞ê ÎÑòÏπòÎäî (Tense)",
    "Îã¨ÏΩ§ÌïòÍ≥† ÏÇ¨ÎûëÏä§Îü¨Ïö¥ (Romantic)",
    "Ïã†ÎÇòÍ≥† ÌéëÌÇ§Ìïú (Funky)",
    "Î™ΩÌôòÏ†ÅÏù∏ (Dreamy)",
    "ÏÑ∏Î†®ÎêòÍ≥† ÎèÑÏãúÏ†ÅÏù∏ (Sophisticated)"
  ];

  const languageOptions = [
    { label: "ÌïúÍµ≠Ïñ¥ Í∞ÄÏÇ¨ (Korean)", value: "Korean" },
    { label: "ÏòÅÏñ¥ Í∞ÄÏÇ¨ (English)", value: "English" },
    { label: "ÌîÑÎûëÏä§Ïñ¥ Í∞ÄÏÇ¨ (French)", value: "French" },
    { label: "Ïä§ÌéòÏù∏Ïñ¥ Í∞ÄÏÇ¨ (Spanish)", value: "Spanish" },
    { label: "ÏùºÎ≥∏Ïñ¥ Í∞ÄÏÇ¨ (Japanese)", value: "Japanese" },
    { label: "Ï§ëÍµ≠Ïñ¥ Í∞ÄÏÇ¨ (Chinese)", value: "Chinese" },
    { label: "ÌòºÌï© (Korean + English)", value: "Korean and English Mixed" },
    { label: "Instrumental (Í∞ÄÏÇ¨ ÏóÜÏùå)", value: "Instrumental" }
  ];

  // --- Logic: Gemini API Call ---
  const callGeminiAPI = async () => {
    if (!selectedLocation || !selectedGenre) {
      alert("Ïû•ÏÜåÏôÄ Ïû•Î•¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!");
      return;
    }

    setIsLoading(true);
    setError("");
    setGeneratedResult({ title: "", prompt: "", lyrics: "", albumArt: "", story: "" }); 

    const isInstrumental = lyricsLanguage === "Instrumental";

    // ÏÑ†ÌÉùÎêú Ïû•ÏÜåÏùò context Ï∞æÍ∏∞
    let selectedContext = "";
    Object.values(locationGroups).forEach(group => {
      const found = group.find(loc => loc.value === selectedLocation);
      if (found) selectedContext = found.context;
    });

    // ÏÑ†ÌÉùÎêú Ïû•Î•¥Ïùò ÏàúÏàò ÏòÅÎ¨∏Î™Ö Ï∂îÏ∂ú (Ïòà: "Jazz (Ïû¨Ï¶à)" -> "Jazz")
    const cleanGenre = selectedGenre.split('(')[0].trim();

    // ÌîÑÎ°¨ÌîÑÌä∏ ÏóîÏßÄÎãàÏñ¥ÎßÅ (ÌôïÏû•Îê®)
    const systemPrompt = `
      You are an expert creative director for a music travel YouTube channel called "E-MusicVibe".
      Your task is to generate a comprehensive creative package based on the user's inputs.
      
      Inputs:
      - Location: ${selectedLocation}
      - Location Context: ${selectedContext}
      - Main Genre: ${cleanGenre}
      - Target Mood: ${selectedVibe}
      - Tempo: ${selectedTempo}
      - Lyrics Language: ${lyricsLanguage}

      Requirements:
      1. **Song Title**: Create a creative and atmospheric song title. 
         - Reflect the specific location's atmosphere.
         - Language matches the lyrics language (or English if Instrumental).
      
      2. **Suno v5.0 Prompt**: Write a detailed style prompt. **MUST BE IN ENGLISH**. 
         - Start with ${cleanGenre}.
         - Include specific instruments (e.g., Accordion for Paris).
         - Add mixing style, atmosphere, bpm. 
         - Use comma-separated keywords.

      3. **Lyrics**: 
         - If 'Instrumental' is selected, set to null.
         - Otherwise, write creative lyrics in **${lyricsLanguage}**. 
         - Structure: [Verse], [Chorus], [Bridge].
      
      4. **Album Art Prompt** (New): Write a prompt for an AI image generator (like Midjourney).
         - Describe a high-quality, atmospheric thumbnail image.
         - Mention lighting, artistic style (e.g., "Cinematic lighting, 4k, digital art, lo-fi anime style" or "Oil painting style").
         - Ensure it visually matches the music genre and location.
         - End with aspect ratio "--ar 16:9".

      5. **YouTube Description** (New): Write a short, engaging video description for the YouTube channel.
         - Tone: "Audio Travel Guide" (inviting, immersive).
         - Describe the scene the listener is "traveling" to.
         - Add 5 relevant hashtags at the end.
         - Language: Korean (since the app user is Korean).
      
      Output Format: JSON object with keys: "title", "prompt", "lyrics", "albumArt", "story".
    `;

    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          contents: [{ parts: [{ text: systemPrompt }] }],
          generationConfig: {
            responseMimeType: "application/json"
          }
        }),
      });

      if (!response.ok) {
        throw new Error(`API Error: ${response.status}`);
      }

      const data = await response.json();
      const generatedText = data.candidates[0].content.parts[0].text;
      const parsedResult = JSON.parse(generatedText);

      setGeneratedResult({
        title: parsedResult.title,
        prompt: parsedResult.prompt,
        lyrics: parsedResult.lyrics || (isInstrumental ? "Instrumental (Í∞ÄÏÇ¨ ÏóÜÏùå)" : ""),
        albumArt: parsedResult.albumArt,
        story: parsedResult.story
      });

    } catch (err) {
      console.error("Gemini API Error:", err);
      setError("AI ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.");
      setGeneratedResult({
        title: `${selectedLocation}Ïùò Ïó¨Ï†ï`,
        prompt: `${cleanGenre}, ${selectedContext}, ${selectedLocation}, ${selectedVibe}, ${selectedTempo} -- v 5.0`,
        lyrics: isInstrumental ? "" : "API Ïò§Î•òÎ°ú Í∞ÄÏÇ¨Î•º ÏÉùÏÑ±ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§.",
        albumArt: "Cyberpunk street, neon lights, 4k --ar 16:9",
        story: "AI Ïò§Î•òÎ°ú ÏÑ§Î™ÖÏùÑ ÏÉùÏÑ±ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§."
      });
    } finally {
      setIsLoading(false);
    }
  };

  // --- Logic: Clipboard ---
  const handleCopy = (text, key) => {
    if (!text) return;
    
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed";
    textArea.style.left = "-9999px";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
      document.execCommand('copy');
      setCopyStatus(prev => ({ ...prev, [key]: true }));
      setTimeout(() => setCopyStatus(prev => ({ ...prev, [key]: false })), 2000);
    } catch (err) {
      console.error('Copy failed', err);
    }
    
    document.body.removeChild(textArea);
  };

  // --- UI Components ---
  return (
    <div className="min-h-screen bg-slate-900 text-slate-100 font-sans pb-20">
      
      {/* Header */}
      <header className="bg-slate-800 border-b border-slate-700 p-6 sticky top-0 z-20 shadow-lg">
        <div className="max-w-4xl mx-auto flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="p-2 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-lg shadow-lg shadow-indigo-500/20">
              <Plane size={24} className="text-white" />
            </div>
            <div>
              <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-400">
                Travel Vibe Builder AI
              </h1>
              <p className="text-xs text-slate-400">Powered by Gemini & Suno v5.0</p>
            </div>
          </div>
          <div className="flex items-center gap-2 text-xs font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-700 text-slate-400">
            <Sparkles size={12} className="text-yellow-400" />
            AI All-In-One
          </div>
        </div>
      </header>

      <main className="max-w-4xl mx-auto p-6 space-y-8">
        
        {/* Input Section */}
        <div className="bg-slate-800 rounded-2xl border border-slate-700 p-6 shadow-xl relative overflow-hidden">
          <div className="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
            <Music size={120} />
          </div>

          <h2 className="text-lg font-semibold text-indigo-300 mb-6 flex items-center gap-2">
            <Radio size={20} />
            1. Ïª®ÏÖâ ÏÑ§Ï†ï (Concept Mix)
          </h2>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 relative z-10">
            {/* Left: Location & Genre */}
            <div className="space-y-4">
              <div className="space-y-2">
                <label className="text-sm text-slate-400 font-medium">Ïñ¥ÎîîÎ°ú Îñ†ÎÇ†ÍπåÏöî? (50+ Locations)</label>
                <div className="relative">
                    <MapPin size={16} className="absolute left-3 top-3.5 text-slate-500" />
                    <select 
                    value={selectedLocation}
                    onChange={(e) => setSelectedLocation(e.target.value)}
                    className="w-full bg-slate-900 border border-slate-600 rounded-xl pl-10 p-3 text-sm focus:outline-none focus:border-indigo-500 transition-colors appearance-none"
                    >
                    <option value="">Ïó¨ÌñâÏßÄ ÏÑ†ÌÉù...</option>
                    {Object.entries(locationGroups).map(([groupName, locations]) => (
                        <optgroup key={groupName} label={groupName} className="bg-slate-800 text-slate-300">
                        {locations.map(loc => (
                            <option key={loc.name} value={loc.value}>
                            {loc.name}
                            </option>
                        ))}
                        </optgroup>
                    ))}
                    </select>
                </div>
              </div>

              <div className="space-y-2">
                <label className="text-sm text-slate-400 font-medium">ÏùåÏïÖ Ïû•Î•¥ (30+ Genres)</label>
                <div className="relative">
                    <Guitar size={16} className="absolute left-3 top-3.5 text-slate-500" />
                    <select 
                      value={selectedGenre}
                      onChange={(e) => setSelectedGenre(e.target.value)}
                      className="w-full bg-slate-900 border border-slate-600 rounded-xl pl-10 p-3 text-sm focus:outline-none focus:border-indigo-500 transition-colors appearance-none"
                    >
                      <option value="">Ïû•Î•¥ ÏÑ†ÌÉù...</option>
                      {Object.entries(genreGroups).map(([groupName, genres]) => (
                          <optgroup key={groupName} label={groupName} className="bg-slate-800 text-slate-300">
                          {genres.map(genre => (
                              <option key={genre} value={genre}>
                              {genre}
                              </option>
                          ))}
                          </optgroup>
                      ))}
                    </select>
                </div>
              </div>
            </div>

            {/* Right: Vibe & Options */}
            <div className="space-y-4">
              <div className="space-y-2">
                <label className="text-sm text-slate-400 font-medium">Î∂ÑÏúÑÍ∏∞ & ÌÖúÌè¨</label>
                <div className="flex gap-2">
                  <select 
                    value={selectedVibe}
                    onChange={(e) => setSelectedVibe(e.target.value)}
                    className="flex-1 bg-slate-900 border border-slate-600 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500"
                  >
                    <option value="">Î∂ÑÏúÑÍ∏∞...</option>
                    {vibes.map(v => <option key={v} value={v}>{v}</option>)}
                  </select>
                  <select 
                    value={selectedTempo}
                    onChange={(e) => setSelectedTempo(e.target.value)}
                    className="w-1/3 bg-slate-900 border border-slate-600 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500"
                  >
                    <option value="Slow">Slow</option>
                    <option value="Mid-Tempo">Mid</option>
                    <option value="Up-Tempo">Fast</option>
                  </select>
                </div>
              </div>

              <div className="space-y-2">
                 <label className="text-sm text-slate-400 font-medium flex items-center gap-2">
                    <Languages size={16} />
                    Í∞ÄÏÇ¨ Ïñ∏Ïñ¥ ÏÑ†ÌÉù (Lyrics Language)
                 </label>
                 <select 
                    value={lyricsLanguage}
                    onChange={(e) => setLyricsLanguage(e.target.value)}
                    className={`w-full border rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-500 transition-colors ${
                        lyricsLanguage === 'Instrumental' 
                        ? 'bg-slate-800 border-indigo-500 text-indigo-300' 
                        : 'bg-slate-900 border-slate-600 text-white'
                    }`}
                  >
                    {languageOptions.map(opt => (
                        <option key={opt.value} value={opt.value}>{opt.label}</option>
                    ))}
                  </select>
              </div>
            </div>
          </div>

          <div className="mt-8 flex justify-end">
            <button 
              onClick={callGeminiAPI}
              disabled={isLoading || !selectedLocation || !selectedGenre}
              className={`
                flex items-center gap-2 px-8 py-3 rounded-xl font-bold text-white shadow-lg transition-all
                ${isLoading 
                  ? 'bg-slate-700 cursor-wait opacity-80' 
                  : 'bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 hover:shadow-indigo-500/25 active:scale-95'}
              `}
            >
              {isLoading ? (
                <>
                  <Loader2 size={20} className="animate-spin" />
                  AIÍ∞Ä ÏΩòÌÖêÏ∏† ÌíÄ Ìå®ÌÇ§ÏßÄ Ï†úÏûë Ï§ë...
                </>
              ) : (
                <>
                  <Sparkles size={20} />
                  AI ÌíÄ Ìå®ÌÇ§ÏßÄ ÏÉùÏÑ± (ÏùåÏïÖ+Í∞ÄÏÇ¨+Ïª§Î≤Ñ+ÏÑ§Î™Ö)
                </>
              )}
            </button>
          </div>
        </div>

        {/* Error Message */}
        {error && (
          <div className="p-4 bg-red-900/50 border border-red-700 text-red-200 rounded-xl text-sm text-center">
            {error}
          </div>
        )}

        {/* Output Section */}
        {(generatedResult.title || isLoading) && (
          <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <div className="flex items-center gap-2 text-indigo-300 font-semibold text-lg px-2">
              <FileText size={20} />
              2. ÏÉùÏÑ± Í≤∞Í≥º (Creative Package)
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* 1. Title & Suno Prompt */}
                <div className="space-y-6">
                    {/* Title Card */}
                    <div className="bg-slate-800 border border-slate-700 rounded-2xl p-6 relative group hover:border-indigo-500/50 transition-colors">
                        <div className="flex justify-between items-start mb-2">
                            <span className="text-xs font-mono text-cyan-400 uppercase tracking-widest">Song Title</span>
                            <button 
                            onClick={() => handleCopy(generatedResult.title, 'title')}
                            className="text-slate-400 hover:text-white transition-colors p-1"
                            title="Copy Title"
                            >
                            {copyStatus.title ? <Check size={16} className="text-green-500" /> : <Copy size={16} />}
                            </button>
                        </div>
                        {isLoading ? (
                            <div className="h-8 bg-slate-700 rounded animate-pulse w-1/2" />
                        ) : (
                            <h3 className="text-2xl font-bold text-white bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">
                            {generatedResult.title}
                            </h3>
                        )}
                    </div>

                    {/* Suno Prompt Card */}
                    <div className="bg-slate-800 border border-slate-700 rounded-2xl p-6 relative group hover:border-indigo-500/50 transition-colors h-full">
                        <div className="flex justify-between items-start mb-2">
                            <span className="text-xs font-mono text-cyan-400 uppercase tracking-widest">Suno v5.0 Prompt</span>
                            <button 
                            onClick={() => handleCopy(generatedResult.prompt, 'prompt')}
                            className="text-slate-400 hover:text-white transition-colors p-1"
                            title="Copy Prompt"
                            >
                            {copyStatus.prompt ? <Check size={16} className="text-green-500" /> : <Copy size={16} />}
                            </button>
                        </div>
                        {isLoading ? (
                            <div className="space-y-2">
                            <div className="h-4 bg-slate-700 rounded animate-pulse w-full" />
                            <div className="h-4 bg-slate-700 rounded animate-pulse w-3/4" />
                            </div>
                        ) : (
                            <p className="text-slate-200 text-lg leading-relaxed font-medium">
                            {generatedResult.prompt}
                            </p>
                        )}
                        {!isLoading && (
                            <div className="mt-3 text-xs text-slate-500 flex gap-2">
                            <span className="bg-slate-900 px-2 py-1 rounded text-indigo-300 font-bold">
                                {selectedGenre.split('(')[0].trim() || 'Genre'}
                            </span>
                            </div>
                        )}
                    </div>
                </div>

                {/* 2. Lyrics Card (or Instrumental) */}
                <div className="bg-slate-800 border border-slate-700 rounded-2xl p-6 relative group hover:border-indigo-500/50 transition-colors flex flex-col">
                     <div className="flex justify-between items-start mb-4">
                        <div className="flex items-center gap-2">
                            <span className="text-xs font-mono text-cyan-400 uppercase tracking-widest">Lyrics ({lyricsLanguage})</span>
                            <span className="text-[10px] bg-indigo-900 text-indigo-200 px-2 py-0.5 rounded-full">AI Generated</span>
                        </div>
                        {lyricsLanguage !== 'Instrumental' && (
                            <button 
                                onClick={() => handleCopy(generatedResult.lyrics, 'lyrics')}
                                className="text-slate-400 hover:text-white transition-colors p-1"
                                title="Copy Lyrics"
                            >
                                {copyStatus.lyrics ? <Check size={16} className="text-green-500" /> : <Copy size={16} />}
                            </button>
                        )}
                    </div>
                    {isLoading ? (
                    <div className="space-y-3 flex-1">
                        <div className="h-4 bg-slate-700 rounded animate-pulse w-1/3" />
                        <div className="h-4 bg-slate-700 rounded animate-pulse w-2/3" />
                        <div className="h-4 bg-slate-700 rounded animate-pulse w-1/2" />
                        <div className="h-20 bg-slate-700 rounded animate-pulse w-full mt-4" />
                    </div>
                    ) : (
                    <div className="bg-slate-900/50 rounded-xl p-4 flex-1 overflow-y-auto custom-scrollbar border border-slate-700/50 max-h-[300px]">
                        <pre className="whitespace-pre-wrap text-slate-300 font-sans text-sm leading-7">
                        {generatedResult.lyrics}
                        </pre>
                    </div>
                    )}
                </div>
            </div>

            {/* NEW: Album Art & YouTube Description Section */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                
                {/* Album Art Prompt */}
                <div className="bg-slate-800 border border-slate-700 rounded-2xl p-6 relative group hover:border-pink-500/50 transition-colors">
                    <div className="flex justify-between items-start mb-4">
                        <div className="flex items-center gap-2 text-pink-300">
                            <Image size={18} />
                            <span className="text-xs font-mono text-pink-400 uppercase tracking-widest">Album Art Prompt</span>
                        </div>
                        <button 
                            onClick={() => handleCopy(generatedResult.albumArt, 'albumArt')}
                            className="text-slate-400 hover:text-white transition-colors p-1"
                            title="Copy Image Prompt"
                        >
                            {copyStatus.albumArt ? <Check size={16} className="text-green-500" /> : <Copy size={16} />}
                        </button>
                    </div>
                    {isLoading ? (
                        <div className="space-y-2">
                             <div className="h-4 bg-slate-700 rounded animate-pulse w-full" />
                             <div className="h-4 bg-slate-700 rounded animate-pulse w-5/6" />
                        </div>
                    ) : (
                        <div>
                             <p className="text-slate-300 text-sm leading-relaxed mb-3">
                                {generatedResult.albumArt}
                             </p>
                             <span className="text-[10px] bg-pink-900/30 text-pink-300 border border-pink-700/50 px-2 py-1 rounded">
                                Use in Midjourney / DALL-E
                             </span>
                        </div>
                    )}
                </div>

                {/* YouTube Description */}
                <div className="bg-slate-800 border border-slate-700 rounded-2xl p-6 relative group hover:border-red-500/50 transition-colors">
                     <div className="flex justify-between items-start mb-4">
                        <div className="flex items-center gap-2 text-red-300">
                            <Video size={18} />
                            <span className="text-xs font-mono text-red-400 uppercase tracking-widest">YouTube Story</span>
                        </div>
                        <button 
                            onClick={() => handleCopy(generatedResult.story, 'story')}
                            className="text-slate-400 hover:text-white transition-colors p-1"
                            title="Copy Description"
                        >
                            {copyStatus.story ? <Check size={16} className="text-green-500" /> : <Copy size={16} />}
                        </button>
                    </div>
                    {isLoading ? (
                        <div className="space-y-2">
                             <div className="h-4 bg-slate-700 rounded animate-pulse w-full" />
                             <div className="h-4 bg-slate-700 rounded animate-pulse w-full" />
                             <div className="h-4 bg-slate-700 rounded animate-pulse w-2/3" />
                        </div>
                    ) : (
                        <div className="bg-slate-900/50 rounded-xl p-3 border border-slate-700/50 max-h-[150px] overflow-y-auto custom-scrollbar">
                             <pre className="whitespace-pre-wrap text-slate-300 font-sans text-sm leading-6">
                                {generatedResult.story}
                             </pre>
                        </div>
                    )}
                </div>

            </div>
            
          </div>
        )}

      </main>

      <style>{`
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #1e293b;
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #475569;
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #64748b;
        }
      `}</style>
    </div>
  );
};

export default SunoPromptBuilder;
